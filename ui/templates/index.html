<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Processing UI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Document Processing System</h1>
        
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                System Health
            </div>
            <div class="card-body">
                <div id="health-status">Loading health information...</div>
                <button id="refresh-health" class="btn btn-sm btn-outline-primary mt-2">Refresh</button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        Process Documents
                    </div>
                    <div class="card-body d-flex flex-column">
                        <p>Process and index documents from the document store into the vector database.</p>
                        <p class="text-muted">This will read all markdown files in the data directory, chunk them, generate embeddings, and store them in ChromaDB.</p>
                        <a href="/process" class="btn btn-success mt-auto">Process Documents</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        Query Documents
                    </div>
                    <div class="card-body d-flex flex-column">
                        <p>Ask questions about the processed documents.</p>
                        <p class="text-muted">Your query will be converted to an embedding, similar documents will be retrieved, and an LLM will generate an answer based on the retrieved content.</p>
                        <a href="/query" class="btn btn-info mt-auto">Query Documents</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-warning text-white">
                        Test Embeddings
                    </div>
                    <div class="card-body d-flex flex-column">
                        <p>Test the embedding functionality.</p>
                        <p class="text-muted">This allows you to test if the embedding model is working correctly by generating an embedding for custom text.</p>
                        <a href="/test-embedding" class="btn btn-warning mt-auto">Test Embeddings</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Function to fetch and display health status
        function checkHealth() {
            const healthDiv = document.getElementById('health-status');
            healthDiv.innerHTML = 'Checking health...';
            
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    let healthHtml = '<h5>UI: ';
                    healthHtml += data.ui.status === 'healthy' ? 
                        '<span class="badge bg-success">Healthy</span>' : 
                        '<span class="badge bg-danger">Unhealthy</span>';
                    healthHtml += '</h5>';
                    
                    healthHtml += '<h5>API: ';
                    if (data.api.status === 'error') {
                        healthHtml += `<span class="badge bg-danger">Unreachable</span>`;
                        healthHtml += `<div class="small text-danger mt-1">${data.api.message}</div>`;
                    } else {
                        // API is reachable, show detailed health info
                        healthHtml += '<div class="mt-2">';
                        
                        // API core status
                        healthHtml += `<div>API: ${data.api.api === 'healthy' ? 
                            '<span class="badge bg-success">Healthy</span>' : 
                            '<span class="badge bg-danger">Unhealthy</span>'}</div>`;
                        
                        // ChromaDB status
                        healthHtml += `<div>ChromaDB: ${data.api.chroma === 'healthy' ? 
                            '<span class="badge bg-success">Healthy</span>' : 
                            '<span class="badge bg-danger">Unhealthy</span>'}</div>`;
                        
                        // Ollama status
                        healthHtml += `<div>Ollama: ${data.api.ollama === 'healthy' ? 
                            '<span class="badge bg-success">Healthy</span>' : 
                            '<span class="badge bg-danger">Unhealthy</span>'}</div>`;
                        
                        // Model status
                        healthHtml += '<div class="mt-2"><strong>Models:</strong>';
                        healthHtml += `<div class="small">Response model: ${data.api.models.response_model || 'Unknown'}</div>`;
                        healthHtml += `<div class="small">Embedding model: ${data.api.models.embedding_model || 'Unknown'}</div>`;
                        healthHtml += '</div>';
                        
                        // Collection status
                        healthHtml += '<div class="mt-2"><strong>Collection:</strong>';
                        healthHtml += `<div class="small">Status: ${data.api.collection.status || 'Unknown'}</div>`;
                        healthHtml += `<div class="small">Document count: ${data.api.collection.document_count || 0}</div>`;
                        healthHtml += '</div>';
                    }
                    
                    healthDiv.innerHTML = healthHtml;
                })
                .catch(error => {
                    healthDiv.innerHTML = `<div class="alert alert-danger">Error checking health: ${error.message}</div>`;
                });
        }
        
        // Check health on page load
        document.addEventListener('DOMContentLoaded', checkHealth);
        
        // Set up refresh button
        document.getElementById('refresh-health').addEventListener('click', checkHealth);
    </script>
</body>
</html>